

SQL> -- foreign key constraint self
SQL> drop table if exists t_emp;

Succeed.

SQL> create table t_emp (empno number(4), mgr number(4), ename varchar2(10));

Succeed.

SQL> alter table t_emp add constraint t_emp_pk primary key(empno);

Succeed.

SQL> alter table t_emp add constraint t_emp_fk foreign key(mgr) references t_emp(empno);

Succeed.

SQL> insert into t_emp values (0,null,'root');

1 rows affected.

SQL> insert into t_emp (empno,mgr) values (1,0);

1 rows affected.

SQL> insert into t_emp (empno,mgr) values (2,1);

1 rows affected.

SQL> insert into t_emp (empno,mgr) values (3,2);

1 rows affected.

SQL> commit;

Succeed.

SQL> -- insert error
SQL> insert into t_emp (empno,mgr) values (10,23);

OG-01128, Integrity constraint violated - parent key not found
SQL> insert into t_emp (empno,mgr) values (5,4);

OG-01128, Integrity constraint violated - parent key not found
SQL> -- update
SQL> update t_emp set mgr = 11 where empno = 3;   -- error

OG-01128, Integrity constraint violated - parent key not found
SQL> update t_emp set mgr = null where empno = 3; -- success

1 rows affected.

SQL> update t_emp set mgr = 3 where empno = 0;    -- success

1 rows affected.

SQL> commit;

Succeed.

SQL> insert into  t_emp values (-1,null,'oGRAC'); -- success

1 rows affected.

SQL> commit;

Succeed.

SQL> delete from t_emp where empno = 1; -- error

OG-01123, The row is referenced by child record
SQL> delete from t_emp where empno = -1; -- success

1 rows affected.

SQL> commit;

Succeed.

SQL> drop table t_emp;
Succeed.





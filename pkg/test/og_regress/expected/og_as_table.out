

SQL> -- test create as table max col size
SQL> drop table if exists t_over_long_col_1;

Succeed.

SQL> drop table if exists t_over_long_col_2;

Succeed.

SQL> create table t_over_long_col_1(c1 varchar(8000));

Succeed.

SQL> insert into t_over_long_col_1 values(lpad('x', 8000, 'y'));

1 rows affected.

SQL> insert into t_over_long_col_1 values(lpad('x', 8000, 'y'));

1 rows affected.

SQL> desc -q select listagg(c1, ';') within group (order by rowid) as res_col from t_over_long_col_1;

Name                                Null?    Type                                
----------------------------------- -------- ------------------------------------
RES_COL                                      VARCHAR(64000 BYTE)                 

SQL> -- except error
SQL> create table t_over_long_col_2(res_col) 
  2     as select listagg(c1, ';') within group (order by rowid) as res_col from t_over_long_col_1;

OG-01346, The column "RES_COL" length exceeded the maximum, (actual: 16001, maximum: 8000).
SQL> drop table if exists t_over_long_col_1;

Succeed.

SQL> drop table if exists t_over_long_col_2;

Succeed.

SQL> 
SQL> drop table if exists t_func_as_tbl_1;

Succeed.

SQL> create table t_func_as_tbl_1(id number(38,5));

Succeed.

SQL> insert into t_func_as_tbl_1 values (1.11);

1 rows affected.

SQL> insert into t_func_as_tbl_1 values (null);

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> CREATE OR REPLACE TYPE user_type_name IS TABLE OF number;
  2 /

Succeed.

SQL> 
SQL> create or replace function my_func(var varchar) return user_type_name
  2 is
  3 var_table user_type_name;
  4 begin
  5   select id BULK COLLECT INTO var_table from t_func_as_tbl_1 t1; 
  6   return var_table;
  7 end;
  8 /

Succeed.

SQL> 
SQL> drop table if exists t_func_as_tbl_2;

Succeed.

SQL> create table t_func_as_tbl_2 as select * from table(cast (my_func('1') as user_type_name));

Succeed.

SQL> select * from t_func_as_tbl_2;

COLUMN_VALUE                            
----------------------------------------
1.11                                    
                                        

2 rows fetched.

SQL> desc t_func_as_tbl_2;

Name                                Null?    Type                                
----------------------------------- -------- ------------------------------------
COLUMN_VALUE                                 NUMBER                              

SQL> drop table if exists t_func_as_tbl_1;

Succeed.

SQL> drop table if exists t_func_as_tbl_2;

Succeed.

SQL> drop type user_type_name;
Succeed.




